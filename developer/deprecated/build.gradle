task setup {
  doLast {
    def dirs = ["$(ANTLR_IN_PRIMARY_DIR)", "$(JAVA_COMP_IN_PRIMARY_DIR)", "$(JVM_IN_DIR)", "$(EXECUTOR_IN_DIR)", "test", "deprecated", "experiment", "ologist", "temporary"]
    dirs.each { dir ->
      mkdir dir
    }
  }
}

task tool(type: Exec) {
  dependsOn setup
  commandLine '$(BIN_MAKE)', '-f', '$(EXECUTOR_IN_DIR)/makefile-tool.mk', '-$(MAKEFLAGS)', 'all'
}

task project(type: Exec) {
  dependsOn tool
  commandLine '$(BIN_MAKE)', '-f', '$(EXECUTOR_IN_DIR)/makefile-project.mk', '-$(MAKEFLAGS)', 'all'
}

task clean {
  doLast {
    println "Use the command `clean <option>` instead of make."
  }
}

task version {
  doLast {
    println "ANTLR_JAR is '${notdir(ANTLR_JAR)}'"
    exec {
      commandLine '$(JAVA_COMP)', '--version'
    }
    exec {
      commandLine '$(JAVA_ARCHIVE)', '--version'
    }
    exec {
      commandLine 'make', '-v'
    }
    println "makefile 0.4"
  }
}

task all {
  dependsOn project
}

task nothing {
  doLast {
    // useful for distinguishing between make syntax errors and build errors
  }
}

tasks.withType(Exec) {
  doFirst {
    println "Executing $name"
  }
}


----------------------
// Function to compile .java files to .class files
def compileJava(source, target) {
  tasks.create(name: "compile${source}", type: Exec) {
    commandLine '$(JAVA_COMP)', '-d', '$(JAVA_COMP_OUT_DIR)', '-sourcepath', '$(JAVA_COMP_IN_DL)', source
    doLast {
      println "Compiled ${source} to ${target}"
    }
  }
}

// Function to create .jar files from .class files
def createJar(source, target) {
  tasks.create(name: "jar${source}", type: Exec) {
    commandLine '$(JAVA_ARCHIVE)', 'cf', target, '-C', '$(JAVA_COMP_OUT_DIR)', source
    doLast {
      println "Created ${target}"
    }
  }
}

// Function to create wrapper scripts from .jar files
def createWrapper(source, target) {
  tasks.create(name: "wrapper${source}", type: Exec) {
    doLast {
      def script = new File(target)
      script.text = "#!/usr/bin/env bash\n$(JAVA_INTERP) -cp ${CLASSPATH}:${JVM_IN_DP}:${JVM_IN_DP}/${source}.jar ${source} \$@"
      script.setExecutable(true)
      println "Created program ${target}"
    }
  }
}
  
